<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>倒库管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body.modal-active { overflow: hidden; }
        .modal { transition: opacity 0.25s ease; }
        .storage-locations {
            max-width: 300px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: help;
        }
        .storage-locations:hover::after {
            content: attr(data-full-text);
            position: absolute;
            left: 0;
            top: 100%;
            background: #1e293b;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            white-space: normal;
            max-width: 400px;
            z-index: 1000;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            font-size: 12px;
            line-height: 1.5;
        }
        .storage-cell {
            position: relative;
        }
    </style>
</head>
<body class="bg-slate-50 p-6">
    <!-- Search Filters -->
    <div class="bg-white rounded-lg shadow mb-6 p-6">
            <div class="flex items-end gap-4">
                <div class="flex-1">
                    <label class="block text-sm font-medium text-slate-700 mb-2">物料批次号</label>
                    <input type="text" id="filter-batch" placeholder="请输入物料批次号" 
                           class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex-1">
                    <label class="block text-sm font-medium text-slate-700 mb-2">物料名称</label>
                    <input type="text" id="filter-name" placeholder="请输入物料名称" 
                           class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex-1">
                    <label class="block text-sm font-medium text-slate-700 mb-2">物料编码</label>
                    <input type="text" id="filter-code" placeholder="请输入物料编码" 
                           class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex-1">
                    <label class="block text-sm font-medium text-slate-700 mb-2">倒库必要性</label>
                    <select id="filter-necessity" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">全部</option>
                        <option value="高">高</option>
                        <option value="中">中</option>
                    </select>
                </div>
                <div class="flex gap-3">
                    <button onclick="searchData()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap">
                        <i class="fas fa-search mr-2"></i>查询
                    </button>
                    <button onclick="resetFilters()" class="px-6 py-2 bg-slate-500 text-white rounded-lg hover:bg-slate-600 transition-colors whitespace-nowrap">
                        <i class="fas fa-redo mr-2"></i>重置
                    </button>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-slate-100 border-b border-slate-200">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">序号</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">物料批次号</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">物料编码</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">物料名称</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">涉及巷道数</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">各巷道存储情况</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">预计空出巷道</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">预计空出巷道数</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">倒库必要性</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">操作</th>
                        </tr>
                    </thead>
                    <tbody id="table-body" class="divide-y divide-slate-200">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
            
            <!-- 分页组件 -->
            <div class="p-4 border-t bg-slate-50 flex items-center justify-between">
                <span class="text-sm text-slate-600">共 <span class="font-bold text-slate-800">3</span> 条记录</span>
                <div class="flex items-center gap-2">
                    <button class="px-3 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-100 transition-all text-sm disabled:opacity-50" disabled>上一页</button>
                    <button class="w-10 h-10 bg-blue-600 text-white rounded-lg font-bold text-sm">1</button>
                    <button class="px-3 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-100 transition-all text-sm disabled:opacity-50" disabled>下一页</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-4/5 max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-slate-200 px-6 py-4 flex justify-between items-center">
                <h3 class="text-xl font-bold text-slate-800">倒库详情</h3>
                <button onclick="closeDetailModal()" class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-slate-700 mb-4">物料批次信息</h4>
                    <div class="grid grid-cols-3 gap-4 bg-slate-50 p-4 rounded-lg">
                        <div>
                            <span class="text-sm text-slate-500">物料批次号：</span>
                            <span class="text-sm font-medium text-slate-800" id="detail-batch"></span>
                        </div>
                        <div>
                            <span class="text-sm text-slate-500">物料编码：</span>
                            <span class="text-sm font-medium text-slate-800" id="detail-code"></span>
                        </div>
                        <div>
                            <span class="text-sm text-slate-500">物料名称：</span>
                            <span class="text-sm font-medium text-slate-800" id="detail-name"></span>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-slate-700 mb-4">当前存储情况</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full border border-slate-200">
                            <thead class="bg-slate-100">
                                <tr>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-slate-600">小车编码</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-slate-600">当前库位</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-slate-600">物料数量</th>
                                </tr>
                            </thead>
                            <tbody id="current-storage-body" class="divide-y divide-slate-200">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-slate-700 mb-4">倒库计划</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full border border-slate-200">
                            <thead class="bg-slate-100">
                                <tr>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-slate-600">小车编码</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-slate-600">当前库位</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-slate-600">目标库位</th>
                                    <th class="px-4 py-2 text-left text-sm font-semibold text-slate-600">物料数量</th>
                                </tr>
                            </thead>
                            <tbody id="transfer-plan-body" class="divide-y divide-slate-200">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                    <h4 class="text-lg font-semibold text-green-700 mb-2">倒库后效果</h4>
                    <div class="text-sm text-slate-700">
                        <p>预计空出巷道：<span id="detail-freed-aisles" class="font-semibold text-green-600"></span></p>
                    </div>
                </div>

                <div class="flex justify-end gap-3">
                    <button onclick="closeDetailModal()" class="px-6 py-2 bg-slate-500 text-white rounded-lg hover:bg-slate-600 transition-colors">
                        取消
                    </button>
                    <button onclick="confirmTransfer()" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        <i class="fas fa-check mr-2"></i>确认倒库
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock data
        const mockData = [
            {
                id: 1,
                batchNo: 'BATCH-2024-001',
                materialCode: 'MAT-001',
                materialName: '电机组件A',
                aisleCount: 10,
                storageLocations: ['库区1-A01-01', '库区1-A01-02', '库区1-A01-03', '库区1-A01-04', '库区1-A01-05', '库区1-A02-01', '库区1-A02-02', '库区1-A03-01', '库区1-A03-02', '库区1-A03-03'],
                targetAisles: ['库区1-A02', '库区1-A03'],
                freedAisleCount: 2,
                necessity: '高',
                currentStorage: [
                    { cartCode: 'CART-001', location: '库区1-A01-01', quantity: 50 },
                    { cartCode: 'CART-002', location: '库区1-A01-02', quantity: 30 },
                    { cartCode: 'CART-003', location: '库区1-A01-03', quantity: 40 },
                    { cartCode: 'CART-004', location: '库区1-A01-04', quantity: 35 },
                    { cartCode: 'CART-005', location: '库区1-A01-05', quantity: 45 },
                    { cartCode: 'CART-006', location: '库区1-A02-01', quantity: 38 },
                    { cartCode: 'CART-007', location: '库区1-A02-02', quantity: 42 },
                    { cartCode: 'CART-008', location: '库区1-A03-01', quantity: 36 },
                    { cartCode: 'CART-009', location: '库区1-A03-02', quantity: 44 },
                    { cartCode: 'CART-010', location: '库区1-A03-03', quantity: 40 }
                ],
                transferPlan: [
                    { cartCode: 'CART-006', currentLocation: '库区1-A02-01', targetLocation: '库区2-A01-06', quantity: 38 },
                    { cartCode: 'CART-007', currentLocation: '库区1-A02-02', targetLocation: '库区2-A01-07', quantity: 42 },
                    { cartCode: 'CART-008', currentLocation: '库区1-A03-01', targetLocation: '库区2-A01-08', quantity: 36 },
                    { cartCode: 'CART-009', currentLocation: '库区1-A03-02', targetLocation: '库区2-A01-09', quantity: 44 },
                    { cartCode: 'CART-010', currentLocation: '库区1-A03-03', targetLocation: '库区2-A01-10', quantity: 40 }
                ]
            },
            {
                id: 2,
                batchNo: 'BATCH-2024-002',
                materialCode: 'MAT-002',
                materialName: '车架部件B',
                aisleCount: 7,
                storageLocations: ['库区2-A01-01', '库区2-A01-02', '库区2-A01-03', '库区2-A01-04', '库区2-A01-05', '库区2-A02-01', '库区2-A02-02'],
                targetAisles: ['库区2-A02'],
                freedAisleCount: 1,
                necessity: '中',
                currentStorage: [
                    { cartCode: 'CART-011', location: '库区2-A01-01', quantity: 60 },
                    { cartCode: 'CART-012', location: '库区2-A01-02', quantity: 45 },
                    { cartCode: 'CART-013', location: '库区2-A01-03', quantity: 55 },
                    { cartCode: 'CART-014', location: '库区2-A01-04', quantity: 50 },
                    { cartCode: 'CART-015', location: '库区2-A01-05', quantity: 48 },
                    { cartCode: 'CART-016', location: '库区2-A02-01', quantity: 52 },
                    { cartCode: 'CART-017', location: '库区2-A02-02', quantity: 47 }
                ],
                transferPlan: [
                    { cartCode: 'CART-016', currentLocation: '库区2-A02-01', targetLocation: '库区2-A01-06', quantity: 52 },
                    { cartCode: 'CART-017', currentLocation: '库区2-A02-02', targetLocation: '库区2-A01-07', quantity: 47 }
                ]
            },
            {
                id: 3,
                batchNo: 'BATCH-2024-003',
                materialCode: 'MAT-003',
                materialName: '轮胎组件C',
                aisleCount: 9,
                storageLocations: ['库区3-A01-01', '库区3-A01-02', '库区3-A01-03', '库区3-A01-04', '库区3-A01-05', '库区3-A02-01', '库区3-A02-02', '库区3-A03-01', '库区3-A04-01'],
                targetAisles: ['库区3-A02', '库区3-A03', '库区3-A04'],
                freedAisleCount: 3,
                necessity: '高',
                currentStorage: [
                    { cartCode: 'CART-018', location: '库区3-A01-01', quantity: 80 },
                    { cartCode: 'CART-019', location: '库区3-A01-02', quantity: 70 },
                    { cartCode: 'CART-020', location: '库区3-A01-03', quantity: 65 },
                    { cartCode: 'CART-021', location: '库区3-A01-04', quantity: 55 },
                    { cartCode: 'CART-022', location: '库区3-A01-05', quantity: 75 },
                    { cartCode: 'CART-023', location: '库区3-A02-01', quantity: 68 },
                    { cartCode: 'CART-024', location: '库区3-A02-02', quantity: 72 },
                    { cartCode: 'CART-025', location: '库区3-A03-01', quantity: 60 },
                    { cartCode: 'CART-026', location: '库区3-A04-01', quantity: 85 }
                ],
                transferPlan: [
                    { cartCode: 'CART-023', currentLocation: '库区3-A02-01', targetLocation: '库区3-A01-06', quantity: 68 },
                    { cartCode: 'CART-024', currentLocation: '库区3-A02-02', targetLocation: '库区3-A01-07', quantity: 72 },
                    { cartCode: 'CART-025', currentLocation: '库区3-A03-01', targetLocation: '库区3-A01-08', quantity: 60 },
                    { cartCode: 'CART-026', currentLocation: '库区3-A04-01', targetLocation: '库区3-A01-09', quantity: 85 }
                ]
            }
        ];

        let currentData = [...mockData];
        let currentDetailId = null;

        // Render table
        function renderTable(data) {
            const tbody = document.getElementById('table-body');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="px-4 py-8 text-center text-slate-500">暂无数据</td></tr>';
                return;
            }

            tbody.innerHTML = data.map((item, index) => {
                const storageText = item.storageLocations.join('、');
                return `
                <tr class="hover:bg-slate-50">
                    <td class="px-4 py-3 text-sm text-slate-600">${index + 1}</td>
                    <td class="px-4 py-3 text-sm font-medium text-slate-800">${item.batchNo}</td>
                    <td class="px-4 py-3 text-sm text-slate-600">${item.materialCode}</td>
                    <td class="px-4 py-3 text-sm text-slate-800">${item.materialName}</td>
                    <td class="px-4 py-3 text-sm text-slate-600">${item.aisleCount}</td>
                    <td class="px-4 py-3 text-sm text-slate-600 storage-cell">
                        <div class="storage-locations" data-full-text="${storageText}">
                            ${storageText}
                        </div>
                    </td>
                    <td class="px-4 py-3 text-sm text-slate-600">
                        <div class="flex flex-wrap gap-1">
                            ${item.targetAisles.map(aisle => `<span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">${aisle}</span>`).join('')}
                        </div>
                    </td>
                    <td class="px-4 py-3 text-sm text-slate-600">${item.freedAisleCount}</td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 rounded text-xs font-medium ${item.necessity === '高' ? 'bg-red-100 text-red-700' : 'bg-orange-100 text-orange-700'}">
                            ${item.necessity}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <button onclick="viewDetail(${item.id})" class="text-green-600 hover:text-green-700 px-2 py-1 text-sm" title="倒库">
                            倒库
                        </button>
                    </td>
                </tr>
                `;
            }).join('');
        }

        // Search data
        function searchData() {
            const batchNo = document.getElementById('filter-batch').value.toLowerCase();
            const name = document.getElementById('filter-name').value.toLowerCase();
            const code = document.getElementById('filter-code').value.toLowerCase();
            const necessity = document.getElementById('filter-necessity').value;

            currentData = mockData.filter(item => {
                return (!batchNo || item.batchNo.toLowerCase().includes(batchNo)) &&
                       (!name || item.materialName.toLowerCase().includes(name)) &&
                       (!code || item.materialCode.toLowerCase().includes(code)) &&
                       (!necessity || item.necessity === necessity);
            });

            renderTable(currentData);
        }

        // Reset filters
        function resetFilters() {
            document.getElementById('filter-batch').value = '';
            document.getElementById('filter-name').value = '';
            document.getElementById('filter-code').value = '';
            document.getElementById('filter-necessity').value = '';
            currentData = [...mockData];
            renderTable(currentData);
        }

        // View detail
        function viewDetail(id) {
            const item = mockData.find(d => d.id === id);
            if (!item) return;

            currentDetailId = id;

            document.getElementById('detail-batch').textContent = item.batchNo;
            document.getElementById('detail-code').textContent = item.materialCode;
            document.getElementById('detail-name').textContent = item.materialName;
            document.getElementById('detail-freed-aisles').textContent = item.targetAisles.join('、');

            // Current storage
            const currentStorageBody = document.getElementById('current-storage-body');
            currentStorageBody.innerHTML = item.currentStorage.map(storage => `
                <tr>
                    <td class="px-4 py-2 text-sm text-slate-800">${storage.cartCode}</td>
                    <td class="px-4 py-2 text-sm text-slate-600">${storage.location}</td>
                    <td class="px-4 py-2 text-sm text-slate-600">${storage.quantity}</td>
                </tr>
            `).join('');

            // Transfer plan
            const transferPlanBody = document.getElementById('transfer-plan-body');
            transferPlanBody.innerHTML = item.transferPlan.map(plan => `
                <tr>
                    <td class="px-4 py-2 text-sm text-slate-800">${plan.cartCode}</td>
                    <td class="px-4 py-2 text-sm text-slate-600">${plan.currentLocation}</td>
                    <td class="px-4 py-2 text-sm text-green-600 font-medium">${plan.targetLocation}</td>
                    <td class="px-4 py-2 text-sm text-slate-600">${plan.quantity}</td>
                </tr>
            `).join('');

            document.getElementById('detail-modal').classList.remove('hidden');
        }

        // Close detail modal
        function closeDetailModal() {
            document.getElementById('detail-modal').classList.add('hidden');
            currentDetailId = null;
        }

        // Confirm transfer
        function confirmTransfer() {
            if (!currentDetailId) return;

            const item = mockData.find(d => d.id === currentDetailId);
            if (!item) return;

            alert(`倒库任务已生成！\n物料批次：${item.batchNo}\n预计空出巷道：${item.freedAisleCount}条`);
            closeDetailModal();
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', function() {
            renderTable(currentData);
        });
    </script>
</body>
</html>
